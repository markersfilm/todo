<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>인터랙티브 예산 분석기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        /* 스크롤바 스타일링 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* contenteditable 플레이스홀더 */
        [contenteditable]:empty:before {
            content: attr(placeholder);
            color: #a0aec0;
            pointer-events: none;
            display: block; /* For Firefox */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
        <!-- 페이지 헤더 -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">인터랙티브 예산 분석기</h1>
            <p class="mt-2 text-lg text-gray-600">프로젝트 예산 항목을 관리하고 시각적으로 분석하세요.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
            
            <!-- 왼쪽: 입력 및 항목 리스트 -->
            <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-4 border-b pb-3">예산 항목 관리</h2>
                
                <!-- 항목 추가 폼 -->
                <div id="add-item-form" class="mb-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="item-name" class="block text-sm font-medium text-gray-700 mb-1">항목명</label>
                            <input type="text" id="item-name" placeholder="예: 미술팀 인건비" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        </div>
                        <div>
                            <label for="item-cost" class="block text-sm font-medium text-gray-700 mb-1">비용 (원)</label>
                            <input type="number" id="item-cost" placeholder="예: 2000000" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        </div>
                    </div>
                    <button id="add-item-btn" class="mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105">
                        항목 추가
                    </button>
                </div>

                <!-- 총 예산 표시 -->
                <div class="bg-gray-100 p-4 rounded-lg mb-6">
                    <h3 class="text-lg font-semibold text-gray-800">총 예산</h3>
                    <p id="total-budget" class="text-2xl font-bold text-blue-600">0 원</p>
                </div>

                <!-- 항목 리스트 -->
                <div id="item-list-container" class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                    <!-- 항목들이 여기에 동적으로 추가됩니다. -->
                </div>
            </div>

            <!-- 오른쪽: 시각화 차트 -->
            <div class="lg:col-span-3 bg-white p-6 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-semibold mb-4 border-b pb-3">예산 비중 분석</h2>
                <div id="chart-container" class="w-full space-y-4">
                    <!-- 차트가 여기에 동적으로 생성됩니다. -->
                </div>
            </div>

        </div>
    </div>

    <script>
        // 초기 데이터 설정
        let budgetItems = [
            { id: 1, name: '작가 원고료', cost: 3600000 },
            { id: 2, name: '5회차 참여 배우 2명 출연료', cost: 3000000 },
            { id: 3, name: '촬영감독(A캠) 인건비', cost: 2250000 },
            { id: 4, name: '촬영 B캠 인건비', cost: 2000000 },
            { id: 5, name: '헤어/메이크업 인건비', cost: 1500000 },
            { id: 6, name: '제작 PD 인건비', cost: 1500000 },
            { id: 7, name: '예비비', cost: 1000000 },
            { id: 8, name: '식대', cost: 1000000 },
            { id: 9, name: '조연출 인건비', cost: 750000 },
            { id: 10, name: '2회차 참여 배우 1명 출연료', cost: 600000 },
        ];

        // UI 요소 가져오기
        const itemNameInput = document.getElementById('item-name');
        const itemCostInput = document.getElementById('item-cost');
        const addItemBtn = document.getElementById('add-item-btn');
        const itemListContainer = document.getElementById('item-list-container');
        const totalBudgetElement = document.getElementById('total-budget');
        const chartContainer = document.getElementById('chart-container');

        // 숫자 포맷 함수 (세 자리마다 콤마)
        const formatNumber = (num) => num.toLocaleString('ko-KR');

        // 전체 UI를 다시 그리는 함수
        const render = () => {
            // 1. 비용 기준으로 내림차순 정렬
            budgetItems.sort((a, b) => b.cost - a.cost);

            // 2. 총 예산 계산
            const totalBudget = budgetItems.reduce((sum, item) => sum + item.cost, 0);
            totalBudgetElement.textContent = `${formatNumber(totalBudget)} 원`;

            // 3. 항목 리스트 렌더링
            itemListContainer.innerHTML = '';
            if (budgetItems.length === 0) {
                itemListContainer.innerHTML = `<p class="text-gray-500 text-center py-4">항목이 없습니다. 새 항목을 추가해주세요.</p>`;
            } else {
                budgetItems.forEach((item, index) => {
                    const percentage = totalBudget > 0 ? ((item.cost / totalBudget) * 100).toFixed(1) : 0;
                    const itemElement = document.createElement('div');
                    itemElement.className = 'p-3 bg-gray-50 rounded-lg flex items-center justify-between gap-2 hover:bg-gray-100 transition';
                    itemElement.innerHTML = `
                        <div class="flex items-center gap-3 flex-grow">
                            <span class="font-bold text-blue-600 w-6 text-center">${index + 1}</span>
                            <div class="flex-grow">
                                <div contenteditable="true" placeholder="항목명" onblur="updateItem(${item.id}, 'name', this.textContent)" class="text-sm font-medium outline-none focus:bg-white px-1 rounded">${item.name}</div>
                                <div class="flex items-baseline gap-2">
                                    <span contenteditable="true" placeholder="비용" onblur="updateItem(${item.id}, 'cost', this.textContent)" class="text-gray-700 font-semibold outline-none focus:bg-white px-1 rounded">${formatNumber(item.cost)}</span>
                                    <span class="text-xs text-gray-500">원</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right flex-shrink-0">
                            <div class="font-bold text-sm">${percentage}%</div>
                            <button onclick="deleteItem(${item.id})" class="text-red-500 hover:text-red-700 text-xs mt-1">삭제</button>
                        </div>
                    `;
                    itemListContainer.appendChild(itemElement);
                });
            }

            // 4. 차트 렌더링
            chartContainer.innerHTML = '';
            if (budgetItems.length === 0) {
                chartContainer.innerHTML = `<div class="flex items-center justify-center h-full"><p class="text-gray-500">표시할 데이터가 없습니다.</p></div>`;
            } else {
                const maxCost = budgetItems.length > 0 ? budgetItems[0].cost : 0;
                const colors = ['#3b82f6', '#60a5fa', '#93c5fd', '#bfdbfe', '#dbeafe'];
                
                budgetItems.forEach((item, index) => {
                    const barWidth = maxCost > 0 ? (item.cost / maxCost) * 100 : 0;
                    const percentage = totalBudget > 0 ? ((item.cost / totalBudget) * 100).toFixed(1) : 0;
                    const color = colors[index % colors.length];

                    const chartElement = document.createElement('div');
                    chartElement.className = 'flex items-center gap-4';
                    chartElement.innerHTML = `
                        <div class="w-2/5 text-sm text-right truncate" title="${item.name}">${item.name}</div>
                        <div class="w-3/5">
                            <div class="w-full bg-gray-200 rounded-full h-6 relative">
                                <div class="bg-blue-500 h-6 rounded-full text-white text-xs flex items-center justify-end pr-2" style="width: ${barWidth}%; background-color: ${color}; min-width: 40px;">
                                    <span class="font-semibold">${percentage}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                    chartContainer.appendChild(chartElement);
                });
            }
        };

        // 항목 추가 함수
        const addItem = () => {
            const name = itemNameInput.value.trim();
            const cost = parseInt(itemCostInput.value, 10);

            if (name && !isNaN(cost) && cost > 0) {
                const newItem = {
                    id: Date.now(), // 고유 ID 생성
                    name,
                    cost
                };
                budgetItems.push(newItem);
                
                // 입력 필드 초기화
                itemNameInput.value = '';
                itemCostInput.value = '';
                itemNameInput.focus();

                render(); // UI 다시 그리기
            } else {
                alert('올바른 항목명과 비용을 입력해주세요.');
            }
        };

        // 항목 삭제 함수
        window.deleteItem = (id) => {
            if (confirm('이 항목을 정말 삭제하시겠습니까?')) {
                budgetItems = budgetItems.filter(item => item.id !== id);
                render();
            }
        };

        // 항목 수정 함수
        window.updateItem = (id, field, value) => {
            const item = budgetItems.find(item => item.id === id);
            if (item) {
                if (field === 'name') {
                    item.name = value.trim();
                } else if (field === 'cost') {
                    const newCost = parseInt(value.replace(/,/g, ''), 10);
                    if (!isNaN(newCost) && newCost >= 0) {
                        item.cost = newCost;
                    }
                }
                render();
            }
        };

        // 이벤트 리스너 연결
        addItemBtn.addEventListener('click', addItem);
        itemCostInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addItem();
            }
        });

        // 초기 렌더링 실행
        render();
    </script>

</body>
</html>
